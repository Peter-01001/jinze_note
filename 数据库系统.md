# 数据库系统

## 第一章 绪论

### 数据库基本概念

**数据**（data）：描述事物的符号记录，数据库存储的基本对象。

**数据库**（database）：保存在==计算机内的==、==有组织的==、==可共享的==数据集合。（该笔记主要针对关系型数据库）

**数据库管理系统**（database management system）：对数据库进行各种控制并保持数据==完整性==和==一致性==的**系统软件**。（介于操作系统和用户应用软件之间的数据管理软件）

**数据库系统**（database system）：与数据库相关的一整套系统，包括数据库、软件（dbms和其他软件）、硬件、人员（dba及其他人员）4部分。

**数据库管理员**（database administrator）

#### 数据库管理系统（软件）

##### 数据操作功能

**数据操作功能**：包括增、删、改、查

#### 数据库系统DBS

##### 数据库系统组成

**数据库管理系统组成**：由数据库、数据库管理系统、应用程序和数据库管理员组成的系统

##### 数据库系统4个特点

**数据库系统4个特点**：

+ 数据结构化
+ 数据共享性强、冗余度低
+ 由数据库管理系统管理
+ 数据独立性

### 数据模型

#### 数据模型2个分类

##### 概念模型（实体……）

**概念模型表示方法**：E-R图

+ 实体型：矩形
+ 属性：圈
+ 联系：菱形

##### 逻辑和物理模型（层次、关系……）

##### 数据模型的组成要素

+ 数据结构
+ 数据操作
+ 数据的完整性约束条件

## 第二章 关系数据库

### 关系

#### 属性个数（目、度）

目=1 单元关系

目=2 双元关系

#### 候选码

#### 主属性

#### 非主属性或非码属性

#### 三种关系类型

+ 基本关系：实际的表
+ 查询表：查询结果对应的表 例如两张表连接所得的表
+ 视图表：基本表或其他视图导出的表

查询、视图表是虚表

#### 基本关系的性质

+ 列同质
+ 不同的的列可出自同一域，不同列名不同
+ 列顺序可换
+ 两元组候选码不同（实体完整性）
+ 行顺序可换
+ 分量必须是原子值（列不可再分）

#### 关系的完整性

+ 实体完整性（主键唯一标识不能取空值，任意两元组主码值不同）
+ 参照完整性（外码参照主码或候选码，不必同名）
+ 用户自定义完整性

### 关系模式与关系

关系模式静态（有什么属性

关系动态

### 关系数据库

关系的集合

#### 关系数据库的型与值

型：关系数据库的模式（模子），包括域和在此域上的关系模式（有什么关系

值：关系数据库具体关系，即关系数据库

### 关系代数

对关系查询的抽象语言

#### 集合运算符

##### 并

R∪S，R和S属性目、域相同，并后重复元组删去

##### 差

R-S，R和S属性目、域相同，在R不在S的元组

##### 交

R∩S，R和S属性目、域相同，在R也在S的元组

##### 笛卡尔积

R×S

#### 专门的关系运算

##### 选择

行 去重

##### 投影

列 去重

##### 连接

+ 一般连接
+ 等值连接
+ 自然连接

##### 除

R➗S

## 第三章 SQL

### SQL特点

+ 综合统一
+ 高度非过程化
+ 面向集合的操作方式
+ 同一种语法结构提供多种使用方式
+ 语言简洁，易学易用

### SQL三级模式结构

### 数据定义

#### 模式定义与删除

##### 模式的定义

    CREATE SCHEMA <模式名> AUTHORIZATION <用户名>   //为用户……定义一个……模式，该用户可操作该模式

##### 模式的删除

    DROP SCHEMA <模式名> <CASCADE | RESTRICT>

CASCADE | RESTRICT两个参数必须二选一

**CASCADE(级联)**：删除模式的同时把该模式中所有的数据库对象删除

**RESTRICT(限制)**：如果该模式中定义了下属的数据库对象（表、视图等）则删除失败

#### 基本表的定义、删除与修改

##### 定义基本表

    CREATE TABLE<表名>(<列名><数据类型>[列级完整性约束条件]
    [,<列名><数据类型>[列级完整性约束条件]]
    ……
    [,<表级完整性约束条件>]);

    CREATE TABLE Student
    (Sno CHAR(9)PRIMARY KEY,                             /*列级完整性约束条件，Sno 是主码*/
    Sname CHAR(20)UNIQUE,                                 /*Sname 取唯一值*/
    Ssex CHAR(2),
    Sage SMALLINT,
    Sdept CHAR(20)
    );

##### 数据类型

##### 修改基本表

    ALTER TABLE<表名>
    [ADD  [COLUMN]<新列名><数据类型>[完整性约束]]
    [ADD<表级完整性约束>]
    [DROP  [COLUMN]<列名>[CASCADE|RESTRICT]]
    [DROP CONSTRAINT<完整性约束名> [RESTRICT|CASCADE]]
    [ALTER COLUMN<列名><数据类型>];

##### 删除基本表

    DROP TABLE<表名> [RESTRICT|CASCADE];

#### 索引的建立与删除

加快查询速度，主码、unique自动建立索引

##### 建立索引

    CREATE [UNIQUE][CLUSTER]INDEX<索引名>
    ON<表名>(<列名>[<次序>][,<列名>[<次序>]]…);

    例： CREATE UNIQUE INDEX SCno ON SC(Sno ASC,Cno DESC);

一个表里只能建立一个聚簇索引

##### 修改索引

    ALTER INDEX<旧索引名>RENAME TO<新索引名>; 

    ALTER INDEX SCno RENAME TO SCSno;

##### 删除索引

    DROP INDX <索引名>
    
#### 数据查询

    SELECT    [ALL|DISTINCT]<目标列表达式>[,<目标列表达式>]…
    FROM<表名或视图名>[,<表名或视图名>…](<SELECT语句>)[AS]<别名>
    [WHERE<条件表达式>]
    [GROUPBY<列名1>[HAVING<条件表达式>]]
    [ORDER BY<列名2> [ASC|DESC]];

##### 确定集合 in

in

在**where**后in某一值集，满足任意一个值则为满足条件

##### 字符匹配

若字符串中没有通配符则like和=一摸一样

    [NOT]LIKE'<匹配串>' [ESCAPE'<换码字符>']

###### 通配符

+ `%`:任意长度的字符串
+ `_`：任意单个字符
  
###### escape

ESCAPE'\ '表示“\”为换码字符。这样匹配串中紧跟在“\”后面的字符“_”不 再具有通配符的含义，转义为普通的“_ ”字符。

    SELECT*
    FROM Course
    WHERE Cname LIKE 'DB\_%i__' ESCAPE'\';

##### 空值查询

    IS NULL 或 IS NOT NULL

is不能用=代替，注意not位置

#### ORDER BY

升序：ASC

降序：DESC

默认升序，空值最大

#### 聚集函数

    COUNT(*)  //统计元组个数
    COUNT([DISTINCT|ALL]  <列名>)  //统计一列中值的个数
    SUM([DISTINCTIALL]   <列名>)  //计算一列值的总和(此列必须是数值型)
    AVG([DISTINCT|ALL]  <列名>)  //计算一列值的平均值(此列必须是数值型)
    MAX([DISTINCT|ALL]  <列名>)  // 求一列值中的最大值
    MIN([DISTINCTIALL]  <列名>)  //求一列值中的最小值

在select后面用

#### GROUP BY

    SELECT Cno,COUNT(Sno)
    FROM SC
    GROUPBY Cno;

select后只能跟group by后的内容或聚集函数

having对分组后的组进行筛选

#### 嵌套查询

子查询只能出现在where和having中，order by不能出现在子查询中

##### in

##### 比较运算符

##### any all

=any 等价于in

##### exists

select 后为*

##### not exists

#### 集合查询

##### union并操作

自动去重

    SELECT Sno
    FROM SC
    WHERE Cno='1
    UNION
    SELECT Sno
    FROM SC
    WHERE Cno='2';

##### intersect 交操作

    SELECT*
    FROM Student
    WHERE Sdept='CS'
    INTERSECT
    SELECT*
    FROM Student
    WHERE Sage<=19;

##### except 差操作

    SELECT*
    FROM Student
    WHERE Sdept='CS'
    EXCEPT
    SELECT*
    FROM Student
    WHERE  Sage<=19;

##### 基于派生表的查询

派生表子查询出现在from语句后而不是where后

as起名，可省略但是必须起名字，派生表的属性如果是操作后的需要起名否则对应原表

### 数据更新

#### 插入数据

##### 插入元组

    INSERT INTO<表名>[(<属性列1>[,<属性列2>]… )]
    VALUES(<常量1>[,<常量2>]… );

属性列不写默认所有列

##### 修改数据

    UPDATE <表名>
    SET<列名>=<表达式>[,<列名>=<表达式>]… [WHERE <条件>];

##### 删除数据

    DELETE
    FROM<表名>
    [WHERE<条件>];

##### 空值的约束条件

+ not null不能为空
+ 码不能为空
+ unique不能为空

空值与另一个值(包括另一个空值)的比较运算的结果为 UNKNOWN

### 视图

虚表，不存放数据

#### 定义视图

    CREATE  VIEW<视图名>[(<列名>[,<列名>]…)]
    AS<子查询>
    [WITH CHECK OPTION];

子查询中不能有distinct或group by

as后为数据来源

#### 删除视图

    DROP VIEW<视图名>[CASCADE];

#### 视图查询

查询时，如果在建立视图的时候加上了with check option，则查询的是带上建立时条件的

#### 视图更新

实际上是对基本表的更新

## 第四章 数据库安全性

### 数据库的不安全因素

### 授权：授予与回收

    GRANT<权限>[,<权限>]…
    ON<对象类型><对象名>[<对象类型><对象名>]…
    TO<用户>[<用户>]…
    [WITH GRANT OPTION];

    REVOKE<权限>[,<权限>]…
    ON<对象类型><对象名>[,<对象类型><对象名>]…
    FROM<用户>[,<用户>]…[CASCADE|RESTRICT]; 

### 数据库角色

#### 创建角色

    CREATE ROLE <角色名>；

#### 授权角色

    GRANT <权限>
    ON <对象类型> <对象名>
    TO <角色>

#### 角色授予其他角色或用户

    GRANT<角色1>[,<角色2>]…
    TO<角色3>[,<用户1>]…
    [WITH ADMIN OPTION]

#### 角色权限收回

    REVOKE<权限>[,<权限>]…
    ON<对象类型><对象名>
    FROM <角色>[,<角色>]…

### 审计

    AUDIT ALTER,UPDATE
    ON  SC;

    NO AUDIT ALTER,UPDATE
    ON  SC;

## 数据库完整性

正确性和相容性

### 实体完整性

### 参照完整性
